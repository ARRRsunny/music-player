<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Player</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-image: url('assets/wallpaper.jpg');
            background-size: cover;
            background-position: center;
            margin: 0;
            color: #fff;
            flex-direction: column;
            overflow: hidden;
        }
        .player {
            background-color: rgba(24, 24, 24, 0.9);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 30px;
            display: flex;
            flex-wrap: wrap;
            width: 90vw;
            max-width: 1080px;
            height: 80vh;
            box-sizing: border-box;
        }
        .left, .right {
            box-sizing: border-box;
            padding: 10px;
        }
        .left {
            flex: 1 1 40%;
            text-align: center;
        }
        .right {
            flex: 1 1 60%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .songName {
            margin: 10px;
        }
        .song-list {
            list-style: none;
            padding: 0;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
            background-color: #282828;
            border-radius: 20px;
        }
        .song-list li {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #333;
        }
        .song-list li:hover {
            background-color: #333;
        }
        img {
            width: 350px;
            height: 350px; 
            border-radius: 50%;
            background-color: #739fda;
            object-fit: cover;
        }
        .lyrics {
            text-align: left;
            height: 200px;
            overflow-y: auto;
            font-size: 1em;
            line-height: 1.4em;
            margin-bottom: 10px;
            padding: 20px;
            background-color: #282828;
            border-radius: 20px;
            flex-grow: 1;
        }
        .highlight {
            background-color: #739fda;
            color: #fff;
            border-radius: 5px;
            padding: 4px;
        }
        h2 {
            font-size: 1.8em;
            margin: 10px 0;
        }
        .controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #282828;
            border-radius: 20px;
            padding: 10px;
            margin-top: 10px;
        }
        .progress-bar {
            flex-grow: 1;
            height: 10px;
            background-color: #7e7e7e;
            border-radius: 5px;
            margin: 0 10px;
            cursor: pointer;
            position: relative;
        }
        .progress {
            height: 100%;
            background-color: #739fda;
            border-radius: 5px;
            width: 0;
        }
        .volume-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #282828;
            border-radius: 20px;
            padding: 15px;
            margin-top: 15px;
        }
        .volume-slider {
            flex-grow: 1;
            height: 10px;
            background-color: #7e7e7e;
            border-radius: 5px;
            margin: 10px;
            cursor: pointer;
            position: relative;
            color: #739fda;
        }
        .info {
            margin-top: 15px;
            height: 0;
            width: 0;
            align-items: center;
            border-radius: 30px;
            display: flex;
            justify-content: center;
            background-color: rgba(24, 24, 24, 0.9);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: all 0.4s ease;
        }
        .info:hover {
            height: 3vw;
            width: 9vw;
            opacity: 1;
        }
        input[type="file"] {
            margin-top: 10px;
            background-color: #282828;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            width: 93%;
        }
        input[type="file"]::-webkit-file-upload-button {
            visibility: hidden;
        }
        input[type="file"]::before {
            content: 'Choose Folder';
            display: inline-block;
            background-color: #c9c9c9;
            color: #fff;
            padding: 10px 10px;
            border-radius: 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.4s ease;
        }
        input[type="file"]:hover::before {
            color: #ffffff;
            background: #739fda;
            transform: scale(1.1);
        }
        button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 1.5em;
        }
        .rotate {
            animation: rotation 20s infinite linear;
            animation-play-state: paused;
        }
        @keyframes rotation {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* From Uiverse.io by Yaya12085 */ 
        .radio-inputs {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            border-radius: 20px;
            background-color: #282828;
            box-sizing: border-box;
            box-shadow: 0 0 0px 1px rgba(0, 0, 0, 0.06);
            padding: 0.25rem;
            margin-top: 15px;
            font-size: 14px;
        }

        .radio-inputs .radio {
            flex: 1 1 auto;
            text-align: center;
        }

        .radio-inputs .radio input {
            display: none;
        }

        .radio-inputs .radio .name {
            display: flex;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            border: none;
            padding: 15px;
            color: rgb(255, 255, 255);
            transition: all .15s ease-in-out;
        }

        .radio-inputs .radio input:checked + .name {
            background-color: #3b3b3b;
            font-weight: 600;
        }
        
    </style>
</head>
<body>
<div class="player">
    <div class="left">
        <div class="rotate" id="rotationImage">
            <img id="songImage" src="assets/defapic.png" alt="Song Image">
        </div>
        <h2 id="songName">Select a song</h2>
        <div class="controls">
            <button id="playPauseButton">‚ñ∂Ô∏è</button>
            <div class="progress-bar" id="progressBar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
        <div class="volume-control">
            üîä
            <input type="range" id="volumeSlider" class="volume-slider" min="0" max="1" step="0.01" value="1">
        </div>
        <div class="radio-inputs">
            <label class="radio">
              <input type="radio" name="mode" value="loop" checked>
              <span class="name">Loop</span>
            </label>
            <label class="radio">
              <input type="radio" name="mode" value="random">
              <span class="name">Random</span>
            </label>
            <label class="radio">
              <input type="radio" name="mode" value="once">
              <span class="name">Once</span>
            </label>
          </div>
    </div>
    <div class="right">
        <div class="lyrics" id="lyricsContainer">Lyrics will appear here...</div>
        <ul class="song-list" id="songList"></ul>
        <input type="file" id="folderInput" webkitdirectory>
    </div>
</div>
<div class="info">  
    <button id="GithublinkBu">üê±</button>
    <h5 id="Auth">@ARRRsunny</h5>
</div>
<script>
    const playerAPI = (() => {
        const audioPlayer = new Audio();
        const folderInput = document.getElementById('folderInput');
        const songList = document.getElementById('songList');
        const songNameDisplay = document.getElementById('songName');
        const songImage = document.getElementById('songImage');
        const lyricsContainer = document.getElementById('lyricsContainer');
        const playPauseButton = document.getElementById('playPauseButton');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const volumeSlider = document.getElementById('volumeSlider');
        const Gitlinkopen = document.getElementById('GithublinkBu');
        const rotationImage = document.getElementById('rotationImage');
        const modeInputs = document.querySelectorAll('input[name="mode"]');

        let isPlaying = false;
        let playbackMode = 'loop';
        let currentSongIndex = 0;
        let songFiles = [];
        let imageFiles = {};
        let lyricsFiles = {};

        folderInput.addEventListener('change', handleFolderChange);
        playPauseButton.addEventListener('click', togglePlayPause);
        progressBar.addEventListener('click', seek);
        volumeSlider.addEventListener('input', changeVolume);
        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', handleSongEnd);
        Gitlinkopen.addEventListener('click', openGitlink);
        modeInputs.forEach(input => input.addEventListener('change', changePlaybackMode));

        function handleFolderChange(event) {
            const files = Array.from(event.target.files);
            songFiles = files.filter(file => file.type.startsWith('audio/'));

            imageFiles = files.reduce((acc, file) => {
                if (file.type.startsWith('image/')) {
                    const baseName = getBaseName(file.name);
                    acc[baseName] = file;
                }
                return acc;
            }, {});

            lyricsFiles = files.reduce((acc, file) => {
                if (file.name.endsWith('.lrc')) {
                    const baseName = getBaseName(file.name);
                    acc[baseName] = file;
                }
                return acc;
            }, {});

            songList.innerHTML = '';
            songFiles.forEach((song, index) => {
                const li = document.createElement('li');
                li.textContent = getBaseName(song.name);
                li.addEventListener('click', () => playSong(index));
                songList.appendChild(li);
            });

            folderInput.style.display = 'none';
        }
        
        function openGitlink() {
            window.open("https://github.com/ARRRsunny/music-player");
        }
        
        function playSong(index) {
            currentSongIndex = index;
            const song = songFiles[index];
            const songURL = URL.createObjectURL(song);
            audioPlayer.src = songURL;
            audioPlayer.play();
            isPlaying = true;
            updatePlayPauseButton();

            const baseName = getBaseName(song.name);
            songNameDisplay.textContent = baseName;

            loadImageAndLyrics(baseName);
            rotationImage.style.animationPlayState = 'running';
        }

        function loadImageAndLyrics(baseName) {
            if (imageFiles[baseName]) {
                const imageURL = URL.createObjectURL(imageFiles[baseName]);
                songImage.src = imageURL;
            } else {
                songImage.src = "assets/defapic.png";
            }

            if (lyricsFiles[baseName]) {
                const reader = new FileReader();
                reader.onload = (e) => displayLyrics(parseLRC(e.target.result));
                reader.readAsText(lyricsFiles[baseName]);
            } else {
                lyricsContainer.textContent = "No lyrics found.";
            }
        }

        function parseLRC(lrcText) {
            const lines = lrcText.split('\n');
            return lines.map(line => {
                const match = line.match(/\[(\d+):(\d+\.\d+)\](.+)/);
                if (match) {
                    const minutes = parseInt(match[1], 10);
                    const seconds = parseFloat(match[2]);
                    const time = minutes * 60 + seconds;
                    const text = match[3];
                    return { time, text };
                }
            }).filter(Boolean);
        }

        function displayLyrics(lyrics) {
            if (lyrics.length === 0) {
                lyricsContainer.textContent = "No lyrics found.";
                return;
            }

            lyricsContainer.innerHTML = '';
            lyrics.forEach(({ time, text }) => {
                const p = document.createElement('p');
                p.setAttribute('data-time', time);
                p.textContent = text;
                lyricsContainer.appendChild(p);
            });

            audioPlayer.addEventListener('timeupdate', () => syncLyrics(lyrics));
        }

        function syncLyrics(lyrics) {
            const currentTime = audioPlayer.currentTime;
            const lines = lyricsContainer.querySelectorAll('p');
            lines.forEach((line, index) => {
                const lineTime = parseFloat(line.getAttribute('data-time'));
                if (currentTime >= lineTime) {
                    lines.forEach(l => l.classList.remove('highlight'));
                    line.classList.add('highlight');

                    const lineHeight = line.offsetHeight;
                    const containerHeight = lyricsContainer.clientHeight;
                    const lineOffset = line.offsetTop;
                    const nextLineTime = index < lines.length - 1 ? parseFloat(lines[index + 1].getAttribute('data-time')) : Infinity;
                    
                    if (currentTime < nextLineTime) {
                        const scrollPosition = lineOffset - containerHeight / 2 + lineHeight / 2 - 200;
                        lyricsContainer.scrollTo({
                            top: scrollPosition,
                            behavior: 'auto'
                        });
                    }
                }
            });
        }

        function togglePlayPause() {
            if (isPlaying) {
                audioPlayer.pause();
                rotationImage.style.animationPlayState = 'paused';
            } else {
                audioPlayer.play();
                rotationImage.style.animationPlayState = 'running';
            }
            isPlaying = !isPlaying;
            updatePlayPauseButton();
        }

        function updatePlayPauseButton() {
            playPauseButton.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
        }

        function updateProgress() {
            const progressPercent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progress.style.width = `${progressPercent}%`;
        }

        function seek(e) {
            const width = progressBar.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            audioPlayer.currentTime = (clickX / width) * duration;
        }

        function changeVolume() {
            audioPlayer.volume = volumeSlider.value;
        }

        function getBaseName(filename) {
            return filename.split('.').slice(0, -1).join('.');
        }

        function handleSongEnd() {
            switch (playbackMode) {
                case 'loop':
                    playSong(currentSongIndex);
                    break;
                case 'random':
                    playSong(Math.floor(Math.random() * songFiles.length));
                    break;
                case 'once':
                    isPlaying = false;
                    updatePlayPauseButton();
                    rotationImage.style.animationPlayState = 'paused';
                    break;
            }
        }

        function changePlaybackMode() {
            playbackMode = document.querySelector('input[name="mode"]:checked').value;
        }

        return {
            playSong,
            loadImageAndLyrics
        };
    })();
</script>
</body>
</html>